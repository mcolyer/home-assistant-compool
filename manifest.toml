version = 1

[install]
python313.pkg-path = "python313"
git.pkg-path = "git"
bash.pkg-path = "bash"
uv.pkg-path = "uv"
ruff.pkg-path = "ruff"
pkg-config.pkg-path = "pkg-config"
gcc.pkg-path = "gcc"
rustc.pkg-path = "rustc"
# PIL/Pillow dependencies
zlib.pkg-path = "zlib"
libjpeg.pkg-path = "libjpeg"
libpng.pkg-path = "libpng"
freetype.pkg-path = "freetype"
lcms2.pkg-path = "lcms2"
openjpeg.pkg-path = "openjpeg"

[vars]
PYTHONPATH = "./custom_components"
UV_PYTHON = "3.13.3"

[hook]
on-activate = '''
echo "🏊 Home Assistant Compool Integration Environment"
echo "Python: $(python --version)"
echo "uv: $(uv --version)"

if [ ! -d ".venv" ]; then
  echo "Setting up Python environment..."
  uv venv --python 3.13.3
  uv pip install -e ".[dev]"
else
  # Check if PIL is working, if not reinstall it
  if ! python -c "from PIL import Image, ImageOps" 2>/dev/null; then
    echo "Reinstalling PIL/Pillow with proper dependencies..."
    uv pip uninstall pillow || true
    uv pip install --no-binary pillow pillow
  fi
fi

source .venv/bin/activate

echo "Available commands:"
echo "  scripts/setup   - Set up development environment"
echo "  scripts/develop - Start Home Assistant in debug mode"
echo "  scripts/lint    - Format and lint code"
echo "  scripts/test    - Run test suite"
'''